<html lang="en">
import { getFirestore, collection, addDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js'
import { getStorage, ref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js'


const firebaseConfig = {
apiKey: "AIzaSyBBIG7IpuY8Hc3E0_zcEyon06an8ll6TGw",
authDomain: "school-test-4b350.firebaseapp.com",
projectId: "school-test-4b350",
storageBucket: "school-test-4b350.firebasestorage.app",
messagingSenderId: "557567714700",
appId: "1:557567714700:web:be0df02162246ee5d5a2a9"
}


const app = initializeApp(firebaseConfig)
const db = getFirestore(app)
const storage = getStorage(app)


// Elements
const addUpdateBtn = document.getElementById('addUpdate')
const updTitle = document.getElementById('updTitle')
const updBody = document.getElementById('updBody')
const updResult = document.getElementById('updResult')


const addEventBtn = document.getElementById('addEvent')
const evtTitle = document.getElementById('evtTitle')
const evtDate = document.getElementById('evtDate')
const evtType = document.getElementById('evtType')
const evtNote = document.getElementById('evtNote')
const evtResult = document.getElementById('evtResult')


const uploadPhotoBtn = document.getElementById('uploadPhoto')
const photoFile = document.getElementById('photoFile')
const photoCaption = document.getElementById('photoCaption')
const photoResult = document.getElementById('photoResult')


addUpdateBtn.addEventListener('click', async ()=>{
updResult.textContent = 'Publishing...'
try{
await addDoc(collection(db,'updates'),{
title: updTitle.value||'Untitled',
body: updBody.value||'',
createdAt: serverTimestamp()
})
updResult.textContent = 'Update published.'
updTitle.value=''; updBody.value=''
}catch(e){ updResult.textContent = 'Failed: '+e.message }
})


addEventBtn.addEventListener('click', async ()=>{
if(!evtDate.value){ evtResult.textContent='Pick a date'; return }
evtResult.textContent='Adding...'
try{
await addDoc(collection(db,'events'),{
title: evtTitle.value||'Event',
date: new Date(evtDate.value),
type: evtType.value,
note: evtNote.value||'',
createdAt: serverTimestamp()
})
evtResult.textContent='Event added.'
evtTitle.value=''; evtDate.value=''; evtNote.value=''
}catch(e){ evtResult.textContent='Failed: '+e.message }
})


uploadPhotoBtn.addEventListener('click', async ()=>{
const f = photoFile.files[0]
if(!f){ photoResult.textContent='Select a file first'; return }
photoResult.textContent='Uploading...'
try{
const fileRef = ref(storage, `gallery/${Date.now()}_${f.name}`)
await uploadBytes(fileRef, f)
const url = await getDownloadURL(fileRef)
// Optionally save URL to Firestore collection for search / captions
await addDoc(collection(db,'gallery'),{ url, caption: photoCaption.value||'', createdAt: serverTimestamp() })
photoResult.innerHTML = 'Uploaded. <a href="'+url+'" target="_blank">Open image</a>'
photoFile.value=''; photoCaption.value=''
}catch(e){ photoResult.textContent='Failed: '+e.message }
})
</script>
</body>
</html>

